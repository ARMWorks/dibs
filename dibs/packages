all_packages=(
	alsa-utils
	apt
	aptitude
	bluez
	crda
	dnsutils
	dosfstools
	dropbear-run
	ifupdown
	iputils-ping
	isc-dhcp-client
	kmod
	less
	libbluetooth3
	locales
	nano
	net-tools
	openssh-client
	openssh-server
	parted
	vim-tiny
	wireless-tools
	wpasupplicant
)

if [[ -n "$DIBS_WORKSPACE" ]] ; then
	if [[ -f "$DIBS_WORKSPACE/board/packages" ]] ; then
		mapfile -O ${#all_packages[@]} all_packages < "$DIBS_WORKSPACE/board/packages"
	fi
	if [[ -f "$DIBS_WORKSPACE/config/packages" ]] ; then
		mapfile -O ${#all_packages[@]} all_packages < "$DIBS_WORKSPACE/config/packages"
	fi
fi

IFS=$'\n' all_packages=($(sort <<< "${all_packages[*]}" | uniq))
IFS=' '

function packages_config()
{
	CONFIG_PACKAGES="$CONFIG_PACKAGE_USERDEFINED"

	for package in "${all_packages[@]}" ; do
		local var="CONFIG_PACKAGE_$(echo "${package}" | tr '[a-z-]' '[A-Z_]')"
		if [[ "y" = "${!var}" ]] ; then
			CONFIG_PACKAGES="$CONFIG_PACKAGES $package"
		fi
	done
}

function packages_generate()
{
	local f="$DIBS_WORKSPACE/config/Kconfig.packages"
	echo "# WARNING: This is an automatically-generated file, do not edit!" > "$f"
	echo "# If you need to add a package to the list please create a \"packages\"" >> "$f"
	echo "# file in this directory, with one package per line." >> "$f"
	echo >> "$f"
	echo "menu \"Packages\"" >> "$f"
	echo -e "\tconfig PACKAGE_USERDEFINED" >> "$f"
	echo -e "\t\tstring \"User defined, space separated list\"" >> "$f"
	for package in "${all_packages[@]}" ; do
		local package_var=PACKAGE_$(echo ${package} | tr '[a-z-]' '[A-Z_]')
		echo -e "\tconfig $package_var" >> "$f"
		echo -e "\t\tbool \"$package\"" >> "$f"
	done
	echo "endmenu" >> "$f"
}

